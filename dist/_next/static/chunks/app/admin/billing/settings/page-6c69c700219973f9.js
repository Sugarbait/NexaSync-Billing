(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{33741:(e,t,s)=>{Promise.resolve().then(s.bind(s,38187))},38187:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var a=s(95155),r=s(12115),n=s(71847);let c=(0,n.A)("test-tube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);var l=s(46046),i=s(42529),o=s(6132),d=s(28297),u=s(70667),y=s(8829),h=s(3941),g=s(53763),p=s(27434),m=s(89559);let x=(0,n.A)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),f=(0,n.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),v=(0,n.A)("cloud-off",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]);var S=s(45987);function b(){let{syncStatus:e,isSyncing:t,forceSync:s}=(0,S.J)(),r=e=>{if(!e)return"Never";let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s,"m ago");let a=Math.floor(s/60);if(a<24)return"".concat(a,"h ago");let r=Math.floor(a/24);return"".concat(r,"d ago")},n=async()=>{t||await s()};return(0,a.jsxs)("button",{onClick:n,disabled:t,className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Last synced: ".concat(r(e.lastSync)).concat(t?" - Syncing...":" - Click to sync now"),children:[t?(0,a.jsx)(m.A,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin"}):e.enabled&&e.lastSync?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,a.jsx)(f,{className:"w-2 h-2 text-green-600 dark:text-green-400 absolute -bottom-0.5 -right-0.5"})]}):e.enabled?(0,a.jsx)(x,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}):(0,a.jsx)(v,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),(0,a.jsx)("span",{className:"hidden sm:inline text-xs text-gray-600 dark:text-gray-400",children:t?"Syncing...":r(e.lastSync)})]})}function _(){let{showNotification:e}=(0,p.h)(),[t,s]=(0,r.useState)(!0),[n,m]=(0,r.useState)(!1),[x,f]=(0,r.useState)(!1),[v,S]=(0,r.useState)(null),[_,k]=(0,r.useState)({stripe_test_mode:!0,default_markup_percentage:0,default_due_date_days:30,default_invoice_note:"",invoice_footer_text:"",notification_email:"",notify_on_invoice_generated:!0,notify_on_payment_received:!0}),[w,j]=(0,r.useState)(""),[N,I]=(0,r.useState)(""),[C,A]=(0,r.useState)(""),[P,T]=(0,r.useState)(""),[E,M]=(0,r.useState)(""),[D,U]=(0,r.useState)(""),[R,O]=(0,r.useState)("");async function F(){s(!0);try{let{data:e}=await h.N.auth.getUser();if(!e.user)return;let{data:t,error:s}=await h.N.from("billing_settings").select("*").eq("user_id",e.user.id).single();t?(k(t),I(t.stripe_publishable_key||"")):s&&"PGRST116"!==s.code&&console.error("Failed to load settings:",s)}catch(e){console.error("Failed to load settings:",e)}finally{s(!1)}}async function V(){m(!0);try{let{data:t}=await h.N.auth.getUser();if(!t.user)throw Error("Not authenticated");let s=_.stripe_api_key_encrypted;w&&(s=await g.M.encryptApiKey(w));let a=_.retell_api_key_encrypted;C&&(a=await g.M.encryptApiKey(C));let r=_.vonage_api_key_encrypted,n=_.vonage_api_secret_encrypted;P&&(r=await g.M.encryptApiKey(P)),E&&(n=await g.M.encryptApiKey(E));let c=_.twilio_account_sid_encrypted,l=_.twilio_auth_token_encrypted;D&&(c=await g.M.encryptApiKey(D)),R&&(l=await g.M.encryptApiKey(R));let i={..._,user_id:t.user.id,stripe_api_key_encrypted:s,stripe_publishable_key:N,retell_api_key_encrypted:a,vonage_api_key_encrypted:r,vonage_api_secret_encrypted:n,twilio_account_sid_encrypted:c,twilio_auth_token_encrypted:l},{error:o}=await h.N.from("billing_settings").upsert(i,{onConflict:"user_id"});if(o)throw o;e("Settings saved successfully","success"),j(""),A(""),T(""),M(""),U(""),O(""),F()}catch(t){console.error("Failed to save settings:",t),e("Failed to save settings","error")}finally{m(!1)}}async function Z(){f(!0),S(null);try{let{data:e}=await h.N.auth.getUser();if(!e.user)throw Error("Not authenticated");await g.M.initialize(e.user.id);let t=await g.M.testConnection();S(t)}catch(e){S({success:!1,message:e instanceof Error?e.message:"Connection test failed"})}finally{f(!1)}}return((0,r.useEffect)(()=>{F()},[]),t)?(0,a.jsx)("div",{className:"p-8",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-8"}),(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"},t))})]})}):(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-black gradient-text",children:"Billing Settings"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Configure Stripe integration and invoice defaults"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Cloud Sync"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Your settings and preferences are automatically synchronized across devices. Use the sync button below to manually sync your data or check the sync status."})}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Sync Status"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Manage your cloud synchronization settings"})]}),(0,a.jsx)(b,{})]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Stripe Integration"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Your Stripe API keys are encrypted and stored securely. Test mode allows you to test invoice generation without creating real charges."})}),(0,a.jsx)(y.pd,{label:"Stripe Secret Key",type:"password",value:w,onChange:e=>j(e.target.value),placeholder:"sk_test_... or sk_live_...",helperText:"Your Stripe Secret Key (starts with sk_). Leave blank to keep existing key."}),(0,a.jsx)(y.pd,{label:"Stripe Publishable Key",value:N,onChange:e=>I(e.target.value),placeholder:"pk_test_... or pk_live_...",helperText:"Your Stripe Publishable Key (starts with pk_)"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Mode"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",checked:_.stripe_test_mode,onChange:()=>k({..._,stripe_test_mode:!0}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\uD83E\uDDEA Test Mode (No real charges)"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",checked:!_.stripe_test_mode,onChange:()=>k({..._,stripe_test_mode:!1}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"⚡ Live Mode (Real invoices and charges)"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(u.$,{variant:"secondary",onClick:Z,loading:x,children:[(0,a.jsx)(c,{className:"w-4 h-4 mr-2"}),"Test Connection"]}),(0,a.jsxs)(u.$,{onClick:V,loading:n,children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Save Stripe Settings"]})]}),v&&(0,a.jsx)("div",{className:"p-4 rounded-lg border ".concat(v.success?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:(0,a.jsxs)("div",{className:"flex items-center",children:[v.success?(0,a.jsx)(i.A,{className:"w-5 h-5 text-green-600 dark:text-green-400 mr-2"}):(0,a.jsx)(o.A,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),(0,a.jsx)("p",{className:"text-sm ".concat(v.success?"text-green-800 dark:text-green-300":"text-red-800 dark:text-red-300"),children:v.message})]})})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Vonage API Integration"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-purple-800 dark:text-purple-300",children:"Configure Vonage (formerly Nexmo) for SMS and Voice services. Your API credentials are encrypted and stored securely."})}),(0,a.jsx)(y.pd,{label:"Vonage API Key",type:"password",value:P,onChange:e=>T(e.target.value),placeholder:"Enter your Vonage API Key",helperText:"Your Vonage API Key. Leave blank to keep existing key."}),(0,a.jsx)(y.pd,{label:"Vonage API Secret",type:"password",value:E,onChange:e=>M(e.target.value),placeholder:"Enter your Vonage API Secret",helperText:"Your Vonage API Secret. Leave blank to keep existing secret."}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"vonage_enabled",checked:_.vonage_api_enabled||!1,onChange:e=>k({..._,vonage_api_enabled:e.target.checked}),className:"mr-2 rounded"}),(0,a.jsx)("label",{htmlFor:"vonage_enabled",className:"text-sm text-gray-600 dark:text-gray-400",children:"Enable Vonage API integration for cost tracking"})]}),(0,a.jsxs)(u.$,{onClick:V,loading:n,children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Save Vonage Settings"]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Twilio API Integration"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-green-800 dark:text-green-300",children:"Configure Twilio for SMS and Voice services. Your API credentials are encrypted and stored securely."})}),(0,a.jsx)(y.pd,{label:"Twilio Account SID",type:"password",value:D,onChange:e=>U(e.target.value),placeholder:"Enter your Twilio Account SID",helperText:"Your Twilio Account SID. Leave blank to keep existing SID."}),(0,a.jsx)(y.pd,{label:"Twilio Auth Token",type:"password",value:R,onChange:e=>O(e.target.value),placeholder:"Enter your Twilio Auth Token",helperText:"Your Twilio Auth Token. Leave blank to keep existing token."}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"twilio_enabled",checked:_.twilio_api_enabled||!1,onChange:e=>k({..._,twilio_api_enabled:e.target.checked}),className:"mr-2 rounded"}),(0,a.jsx)("label",{htmlFor:"twilio_enabled",className:"text-sm text-gray-600 dark:text-gray-400",children:"Enable Twilio API integration for cost tracking"})]}),(0,a.jsxs)(u.$,{onClick:V,loading:n,children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Save Twilio Settings"]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Invoice Defaults"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)(y.pd,{label:"Default Markup Percentage",type:"number",min:"0",max:"10000",step:"0.1",value:_.default_markup_percentage||0,onChange:e=>k({..._,default_markup_percentage:parseFloat(e.target.value)}),helperText:"Default markup applied to all new customers (can be overridden per customer)"}),(0,a.jsx)(y.l6,{label:"Payment Terms",value:_.default_due_date_days||30,onChange:e=>k({..._,default_due_date_days:parseInt(e.target.value)}),options:[{value:0,label:"Due on Receipt"},{value:15,label:"Net 15 (15 days)"},{value:30,label:"Net 30 (30 days)"},{value:60,label:"Net 60 (60 days)"},{value:90,label:"Net 90 (90 days)"}]}),(0,a.jsx)(y.TM,{label:"Default Invoice Note",value:_.default_invoice_note||"",onChange:e=>k({..._,default_invoice_note:e.target.value}),rows:3,placeholder:"Thank you for your business...",helperText:"This note will appear on all invoices"}),(0,a.jsx)(y.TM,{label:"Invoice Footer",value:_.invoice_footer_text||"",onChange:e=>k({..._,invoice_footer_text:e.target.value}),rows:2,placeholder:"NexaSync Billing | www.nexasync.com | support@nexasync.com",helperText:"Footer text displayed at bottom of invoices"}),(0,a.jsxs)(u.$,{onClick:V,loading:n,children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Save Invoice Defaults"]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Email Notifications"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)(y.pd,{label:"Notification Email",type:"email",value:_.notification_email||"",onChange:e=>k({..._,notification_email:e.target.value}),placeholder:"billing@example.com",helperText:"Email address to receive billing notifications"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:_.notify_on_invoice_generated,onChange:e=>k({..._,notify_on_invoice_generated:e.target.checked}),className:"mr-2 rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send email summary when invoices are created"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:_.notify_on_payment_received,onChange:e=>k({..._,notify_on_payment_received:e.target.checked}),className:"mr-2 rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send email when Stripe reports payment received"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Note: Payment notifications require Stripe webhook configuration (Phase 2)"}),(0,a.jsxs)(u.$,{onClick:V,loading:n,children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Save Notification Settings"]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{children:"Automatic Invoice Generation"})}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"⚠️ Automation is currently in development. Manual invoice generation is recommended."})}),(0,a.jsx)("div",{className:"opacity-50 pointer-events-none",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",disabled:!0,className:"mr-2 rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Automatically generate invoices monthly (Coming in Phase 2)"})]})})]})]})]})]})}},45987:(e,t,s)=>{"use strict";s.d(t,{a:()=>o,J:()=>d});var a=s(95155),r=s(12115),n=s(3941);class c{initializeSync(){console.log("CloudSyncService initialized:",{deviceId:this.deviceId,syncEnabled:this.syncEnabled})}getOrCreateDeviceId(){let e=localStorage.getItem("billing_device_id");return e||(e="undefined"!=typeof crypto&&crypto.randomUUID?"device_".concat(crypto.randomUUID()):"device_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,11)),localStorage.setItem("billing_device_id",e)),e}setUserId(e){this.userId=e,console.log("CloudSyncService: User ID set to",e),this.checkAndInitializeSync()}async checkAndInitializeSync(){try{let{error:e}=await n.N.from("user_preferences").select("user_id").limit(1);if(e&&"42P01"===e.code){console.info("CloudSyncService: Cloud sync disabled - table not found. Run migration to enable."),console.info("See CLOUD_SYNC_SETUP.md for setup instructions.");return}await this.syncFromCloud(),this.syncEnabled&&(this.startAutoSync(),this.setupRealtimeSync())}catch(e){console.info("CloudSyncService: Using local storage only")}}async syncToCloud(e){if(!this.userId)return{success:!1,message:"User not authenticated"};try{let t={user_id:this.userId,device_id:this.deviceId,preferences:e,last_updated:new Date().toISOString(),version:1},{error:s}=await n.N.from("user_preferences").upsert(t,{onConflict:"user_id"});if(s){if("42P01"===s.code)return console.warn("CloudSyncService: user_preferences table does not exist. Run the migration in Supabase."),localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(e)),{success:!0,message:"Saved locally - table not found"};return console.warn("CloudSyncService: Sync to cloud error (code: "+s.code+"):",s.message),localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(e)),{success:!1,message:s.message}}return localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(e)),localStorage.setItem("lastSync_".concat(this.userId),new Date().toISOString()),console.log("CloudSyncService: Preferences synced to cloud"),{success:!0,message:"Preferences synced successfully"}}catch(t){return console.warn("CloudSyncService: Sync to cloud error:",t),localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(e)),{success:!1,message:t instanceof Error?t.message:"Unknown error"}}}async syncFromCloud(){if(!this.userId)return{success:!1,message:"User not authenticated"};try{let{data:e,error:t}=await n.N.from("user_preferences").select("*").eq("user_id",this.userId).maybeSingle();if(t){if(console.error("CloudSyncService: Detailed error:",{code:t.code,message:t.message,details:t.details,hint:t.hint,userId:this.userId}),"42P01"===t.code)return console.warn("CloudSyncService: user_preferences table does not exist. Run the migration in Supabase."),{success:!0,preferences:{},message:"Table not found - migration required"};return console.warn("CloudSyncService: Sync error (code: "+t.code+"):",t.message),{success:!1,message:t.message}}if(!e)return console.log("CloudSyncService: No preferences found in cloud"),{success:!0,preferences:{},message:"No preferences found"};if(e){let t=e.preferences;return localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(t)),localStorage.setItem("lastSync_".concat(this.userId),new Date().toISOString()),console.log("CloudSyncService: Preferences synced from cloud"),{success:!0,preferences:t,message:"Preferences loaded successfully"}}return{success:!0,preferences:{},message:"No preferences found"}}catch(e){return console.warn("CloudSyncService: Sync from cloud error:",e),{success:!0,preferences:{},message:"Sync failed - using local cache"}}}setupRealtimeSync(){this.userId&&!this.realtimeChannel&&(this.realtimeChannel=n.N.channel("user_preferences:".concat(this.userId)).on("postgres_changes",{event:"*",schema:"public",table:"user_preferences",filter:"user_id=eq.".concat(this.userId)},e=>{if(console.log("CloudSyncService: Real-time update received",e),e.new&&"object"==typeof e.new&&"device_id"in e.new){let t=e.new;if(t.device_id!==this.deviceId){let e=t.preferences;localStorage.setItem("preferences_".concat(this.userId),JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cloudPreferencesUpdated",{detail:e}))}}}).subscribe(),console.log("CloudSyncService: Real-time sync enabled"))}startAutoSync(){this.syncEnabled&&this.userId&&(this.stopAutoSync(),this.autoSyncIntervalId=window.setInterval(async()=>{if(this.userId&&this.syncEnabled)try{console.log("CloudSyncService: Auto-sync check");let e=await this.syncFromCloud();e.success&&e.preferences&&window.dispatchEvent(new CustomEvent("cloudPreferencesUpdated",{detail:e.preferences}))}catch(e){console.error("Auto-sync error:",e)}},this.autoSyncInterval),console.log("CloudSyncService: Auto-sync started"))}stopAutoSync(){null!==this.autoSyncIntervalId&&(window.clearInterval(this.autoSyncIntervalId),this.autoSyncIntervalId=null,console.log("CloudSyncService: Auto-sync stopped")),this.realtimeChannel&&(this.realtimeChannel.unsubscribe(),this.realtimeChannel=null,console.log("CloudSyncService: Real-time sync stopped"))}async forceSyncNow(){if(!this.userId)return{success:!1,message:"User not authenticated"};try{let e=localStorage.getItem("preferences_".concat(this.userId)),t=e?JSON.parse(e):{},s=await this.syncToCloud(t);if(s.success)return{success:!0,message:"Preferences synced to cloud"};return{success:!1,message:s.message||"Sync failed"}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Unknown error"}}}getSyncStatus(){let e=localStorage.getItem("lastSync_".concat(this.userId));return{enabled:this.syncEnabled,lastSync:e||void 0,deviceId:this.deviceId}}getCachedPreferences(){if(!this.userId)return null;let e=localStorage.getItem("preferences_".concat(this.userId));if(e)try{return JSON.parse(e)}catch(e){console.error("Failed to parse cached preferences:",e)}return null}cleanup(){this.stopAutoSync(),this.userId=null,console.log("CloudSyncService: Cleaned up")}constructor(){this.userId=null,this.syncEnabled=!0,this.autoSyncInterval=3e4,this.autoSyncIntervalId=null,this.realtimeChannel=null,this.deviceId=this.getOrCreateDeviceId(),this.initializeSync()}}let l=new c,i=(0,r.createContext)(void 0);function o(e){let{children:t,userId:s}=e,[n,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(l.getSyncStatus()),[u,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(s){l.setUserId(s);let e=l.getCachedPreferences();e&&c(e),h(),d(l.getSyncStatus())}return()=>{s||l.cleanup()}},[s]),(0,r.useEffect)(()=>{let e=e=>{console.log("CloudSyncProvider: Preferences updated from cloud",e.detail),c(e.detail),d(l.getSyncStatus())};return window.addEventListener("cloudPreferencesUpdated",e),()=>{window.removeEventListener("cloudPreferencesUpdated",e)}},[]);let h=(0,r.useCallback)(async()=>{if(s){y(!0);try{let e=await l.syncFromCloud();e.success&&e.preferences&&(c(e.preferences),d(l.getSyncStatus()))}catch(e){console.debug("CloudSyncProvider: Sync completed with fallback")}finally{y(!1)}}},[s]),g=(0,r.useCallback)(async e=>{if(!s)return;let t={...n,...e};c(t),y(!0);try{await l.syncToCloud(t),d(l.getSyncStatus())}catch(e){console.debug("CloudSyncProvider: Update completed with fallback")}finally{y(!1)}},[n,s]),p=(0,r.useCallback)(async()=>{if(s){y(!0);try{await l.forceSyncNow(),await h()}catch(e){console.debug("CloudSyncProvider: Force sync completed with fallback")}finally{y(!1)}}},[s,h]);return(0,a.jsx)(i.Provider,{value:{preferences:n,syncStatus:o,isSyncing:u,updatePreferences:g,forceSync:p},children:t})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useCloudSync must be used within a CloudSyncProvider");return e}},46046:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},89559:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[143,365,35,441,255,358],()=>e(e.s=33741)),_N_E=e.O()}]);