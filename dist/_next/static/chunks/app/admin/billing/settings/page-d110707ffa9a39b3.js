(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{33741:(e,a,t)=>{Promise.resolve().then(t.bind(t,39396))},39396:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>g});var s=t(95155),r=t(12115);let l=(0,t(71847).A)("test-tube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);var n=t(46046),i=t(42529),c=t(6132),o=t(28297),d=t(70667),p=t(8829),x=t(3941),u=t(53763),h=t(27434);function g(){let{showNotification:e}=(0,h.h)(),[a,t]=(0,r.useState)(!0),[g,m]=(0,r.useState)(!1),[y,_]=(0,r.useState)(!1),[v,b]=(0,r.useState)(null),[k,j]=(0,r.useState)({stripe_test_mode:!0,default_markup_percentage:0,default_due_date_days:30,default_invoice_note:"",invoice_footer_text:"",notification_email:"",notify_on_invoice_generated:!0,notify_on_payment_received:!0}),[N,f]=(0,r.useState)(""),[w,S]=(0,r.useState)(""),[A,C]=(0,r.useState)(""),[T,I]=(0,r.useState)(""),[M,P]=(0,r.useState)(""),[E,V]=(0,r.useState)(""),[D,K]=(0,r.useState)("");async function Z(){t(!0);try{let{data:e}=await x.N.auth.getUser();if(!e.user)return;let{data:a,error:t}=await x.N.from("billing_settings").select("*").eq("user_id",e.user.id).single();a?(j(a),S(a.stripe_publishable_key||"")):t&&"PGRST116"!==t.code&&console.error("Failed to load settings:",t)}catch(e){console.error("Failed to load settings:",e)}finally{t(!1)}}async function F(){m(!0);try{let{data:a}=await x.N.auth.getUser();if(!a.user)throw Error("Not authenticated");let t=k.stripe_api_key_encrypted;N&&(t=await u.M.encryptApiKey(N));let s=k.retell_api_key_encrypted;A&&(s=await u.M.encryptApiKey(A));let r=k.vonage_api_key_encrypted,l=k.vonage_api_secret_encrypted;T&&(r=await u.M.encryptApiKey(T)),M&&(l=await u.M.encryptApiKey(M));let n=k.twilio_account_sid_encrypted,i=k.twilio_auth_token_encrypted;E&&(n=await u.M.encryptApiKey(E)),D&&(i=await u.M.encryptApiKey(D));let c={...k,user_id:a.user.id,stripe_api_key_encrypted:t,stripe_publishable_key:w,retell_api_key_encrypted:s,vonage_api_key_encrypted:r,vonage_api_secret_encrypted:l,twilio_account_sid_encrypted:n,twilio_auth_token_encrypted:i},{error:o}=await x.N.from("billing_settings").upsert(c,{onConflict:"user_id"});if(o)throw o;e("Settings saved successfully","success"),f(""),C(""),I(""),P(""),V(""),K(""),Z()}catch(a){console.error("Failed to save settings:",a),e("Failed to save settings","error")}finally{m(!1)}}async function R(){_(!0),b(null);try{let{data:e}=await x.N.auth.getUser();if(!e.user)throw Error("Not authenticated");await u.M.initialize(e.user.id);let a=await u.M.testConnection();b(a)}catch(e){b({success:!1,message:e instanceof Error?e.message:"Connection test failed"})}finally{_(!1)}}return((0,r.useEffect)(()=>{Z()},[]),a)?(0,s.jsx)("div",{className:"p-8",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-8"}),(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,a)=>(0,s.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"},a))})]})}):(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-black gradient-text",children:"Billing Settings"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Configure Stripe integration and invoice defaults"})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Stripe Integration"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Your Stripe API keys are encrypted and stored securely. Test mode allows you to test invoice generation without creating real charges."})}),(0,s.jsx)(p.pd,{label:"Stripe Secret Key",type:"password",value:N,onChange:e=>f(e.target.value),placeholder:"sk_test_... or sk_live_...",helperText:"Your Stripe Secret Key (starts with sk_). Leave blank to keep existing key."}),(0,s.jsx)(p.pd,{label:"Stripe Publishable Key",value:w,onChange:e=>S(e.target.value),placeholder:"pk_test_... or pk_live_...",helperText:"Your Stripe Publishable Key (starts with pk_)"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Mode"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:k.stripe_test_mode,onChange:()=>j({...k,stripe_test_mode:!0}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\uD83E\uDDEA Test Mode (No real charges)"})]}),(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:!k.stripe_test_mode,onChange:()=>j({...k,stripe_test_mode:!1}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"⚡ Live Mode (Real invoices and charges)"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)(d.$,{variant:"secondary",onClick:R,loading:y,children:[(0,s.jsx)(l,{className:"w-4 h-4 mr-2"}),"Test Connection"]}),(0,s.jsxs)(d.$,{onClick:F,loading:g,children:[(0,s.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Save Stripe Settings"]})]}),v&&(0,s.jsx)("div",{className:"p-4 rounded-lg border ".concat(v.success?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:(0,s.jsxs)("div",{className:"flex items-center",children:[v.success?(0,s.jsx)(i.A,{className:"w-5 h-5 text-green-600 dark:text-green-400 mr-2"}):(0,s.jsx)(c.A,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-2"}),(0,s.jsx)("p",{className:"text-sm ".concat(v.success?"text-green-800 dark:text-green-300":"text-red-800 dark:text-red-300"),children:v.message})]})})]})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Vonage API Integration"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-purple-800 dark:text-purple-300",children:"Configure Vonage (formerly Nexmo) for SMS and Voice services. Your API credentials are encrypted and stored securely."})}),(0,s.jsx)(p.pd,{label:"Vonage API Key",type:"password",value:T,onChange:e=>I(e.target.value),placeholder:"Enter your Vonage API Key",helperText:"Your Vonage API Key. Leave blank to keep existing key."}),(0,s.jsx)(p.pd,{label:"Vonage API Secret",type:"password",value:M,onChange:e=>P(e.target.value),placeholder:"Enter your Vonage API Secret",helperText:"Your Vonage API Secret. Leave blank to keep existing secret."}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"vonage_enabled",checked:k.vonage_api_enabled||!1,onChange:e=>j({...k,vonage_api_enabled:e.target.checked}),className:"mr-2 rounded"}),(0,s.jsx)("label",{htmlFor:"vonage_enabled",className:"text-sm text-gray-600 dark:text-gray-400",children:"Enable Vonage API integration for cost tracking"})]}),(0,s.jsxs)(d.$,{onClick:F,loading:g,children:[(0,s.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Save Vonage Settings"]})]})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Twilio API Integration"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-green-800 dark:text-green-300",children:"Configure Twilio for SMS and Voice services. Your API credentials are encrypted and stored securely."})}),(0,s.jsx)(p.pd,{label:"Twilio Account SID",type:"password",value:E,onChange:e=>V(e.target.value),placeholder:"Enter your Twilio Account SID",helperText:"Your Twilio Account SID. Leave blank to keep existing SID."}),(0,s.jsx)(p.pd,{label:"Twilio Auth Token",type:"password",value:D,onChange:e=>K(e.target.value),placeholder:"Enter your Twilio Auth Token",helperText:"Your Twilio Auth Token. Leave blank to keep existing token."}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"twilio_enabled",checked:k.twilio_api_enabled||!1,onChange:e=>j({...k,twilio_api_enabled:e.target.checked}),className:"mr-2 rounded"}),(0,s.jsx)("label",{htmlFor:"twilio_enabled",className:"text-sm text-gray-600 dark:text-gray-400",children:"Enable Twilio API integration for cost tracking"})]}),(0,s.jsxs)(d.$,{onClick:F,loading:g,children:[(0,s.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Save Twilio Settings"]})]})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Invoice Defaults"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)(p.pd,{label:"Default Markup Percentage",type:"number",min:"0",max:"10000",step:"0.1",value:k.default_markup_percentage||0,onChange:e=>j({...k,default_markup_percentage:parseFloat(e.target.value)}),helperText:"Default markup applied to all new customers (can be overridden per customer)"}),(0,s.jsx)(p.l6,{label:"Payment Terms",value:k.default_due_date_days||30,onChange:e=>j({...k,default_due_date_days:parseInt(e.target.value)}),options:[{value:0,label:"Due on Receipt"},{value:15,label:"Net 15 (15 days)"},{value:30,label:"Net 30 (30 days)"},{value:60,label:"Net 60 (60 days)"},{value:90,label:"Net 90 (90 days)"}]}),(0,s.jsx)(p.TM,{label:"Default Invoice Note",value:k.default_invoice_note||"",onChange:e=>j({...k,default_invoice_note:e.target.value}),rows:3,placeholder:"Thank you for your business...",helperText:"This note will appear on all invoices"}),(0,s.jsx)(p.TM,{label:"Invoice Footer",value:k.invoice_footer_text||"",onChange:e=>j({...k,invoice_footer_text:e.target.value}),rows:2,placeholder:"NexaSync Billing | www.nexasync.com | support@nexasync.com",helperText:"Footer text displayed at bottom of invoices"}),(0,s.jsxs)(d.$,{onClick:F,loading:g,children:[(0,s.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Save Invoice Defaults"]})]})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Email Notifications"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)(p.pd,{label:"Notification Email",type:"email",value:k.notification_email||"",onChange:e=>j({...k,notification_email:e.target.value}),placeholder:"billing@example.com",helperText:"Email address to receive billing notifications"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:k.notify_on_invoice_generated,onChange:e=>j({...k,notify_on_invoice_generated:e.target.checked}),className:"mr-2 rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send email summary when invoices are created"})]}),(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:k.notify_on_payment_received,onChange:e=>j({...k,notify_on_payment_received:e.target.checked}),className:"mr-2 rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send email when Stripe reports payment received"})]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Note: Payment notifications require Stripe webhook configuration (Phase 2)"}),(0,s.jsxs)(d.$,{onClick:F,loading:g,children:[(0,s.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Save Notification Settings"]})]})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsx)(o.ZB,{children:"Automatic Invoice Generation"})}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"⚠️ Automation is currently in development. Manual invoice generation is recommended."})}),(0,s.jsx)("div",{className:"opacity-50 pointer-events-none",children:(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",disabled:!0,className:"mr-2 rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Automatically generate invoices monthly (Coming in Phase 2)"})]})})]})]})]})]})}},46046:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},e=>{e.O(0,[143,365,35,441,255,358],()=>e(e.s=33741)),_N_E=e.O()}]);