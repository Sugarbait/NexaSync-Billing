(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{5370:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(71847).A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]])},28666:(e,r,a)=>{Promise.resolve().then(a.bind(a,79707))},53233:(e,r,a)=>{"use strict";a.d(r,{g:()=>d});var s=a(12503),t=a(52769),l=a(15376).Buffer;class n{generateSecret(){return s.authenticator.generateSecret()}async generateQRCode(e,r){let a=s.authenticator.keyuri(e,"NexaSync Billing",r);try{return await t.toDataURL(a)}catch(e){throw console.error("Failed to generate QR code:",e),Error("Failed to generate QR code")}}generateBackupCodes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,r=[];for(let a=0;a<e;a++){let e=Math.random().toString(36).substring(2,10).toUpperCase();r.push(e)}return r}verifyToken(e,r){try{let a=e.replace(/[\s-]/g,"");return s.authenticator.verify({token:a,secret:r})}catch(e){return console.error("Token verification failed:",e),!1}}generateToken(e){return s.authenticator.generate(e)}encryptSecret(e){return l.from(e).toString("base64")}decryptSecret(e){return l.from(e,"base64").toString("utf-8")}formatSecretForDisplay(e){var r;return(null==(r=e.match(/.{1,4}/g))?void 0:r.join(" "))||e}}let d=new n},75426:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(71847).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},79707:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>N});var s=a(95155),t=a(12115),l=a(71847);let n=(0,l.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),d=(0,l.A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var i=a(17910),c=a(5370);let o=(0,l.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var x=a(11010),m=a(71360),u=a(78874),h=a(75426),g=a(28297),p=a(70667),y=a(8829),b=a(25828),f=a(44754),j=a(3941),w=a(53233),v=a(27434);async function k(e,r){return console.warn("Password update is not available in static hosting mode"),{success:!1,error:"Password updates require a backend server. Please use Supabase dashboard to update passwords."}}function N(){let{showNotification:e,showConfirm:r}=(0,v.h)(),[a,l]=(0,t.useState)(!0),[N,_]=(0,t.useState)([]),[C,S]=(0,t.useState)("all"),[A,F]=(0,t.useState)(!1),[P,E]=(0,t.useState)(!1),[U,M]=(0,t.useState)(!1),[D,q]=(0,t.useState)(!1),[$,I]=(0,t.useState)("qrcode"),[R,L]=(0,t.useState)(null),[O,T]=(0,t.useState)({secret:"",qrCode:"",backupCodes:[]}),[Q,z]=(0,t.useState)(""),[B,G]=(0,t.useState)(""),[V,Z]=(0,t.useState)(""),[H,K]=(0,t.useState)(null),[W,J]=(0,t.useState)(null),[X,Y]=(0,t.useState)({email:"",full_name:"",password:"",confirmPassword:"",role:"admin",mfa_enabled:!1}),[ee,er]=(0,t.useState)(!0),[ea,es]=(0,t.useState)({email:"",role:"admin"}),[et,el]=(0,t.useState)(!1),[en,ed]=(0,t.useState)(null),[ei,ec]=(0,t.useState)({newPassword:"",confirmNewPassword:""});async function eo(){l(!0);try{let{data:{user:e}}=await j.N.auth.getUser();if(!e){console.error("Not authenticated"),_([]);return}let{data:r,error:a}=await j.N.from("billing_users").select("*").order("created_at",{ascending:!1});if(a)throw console.error("Supabase error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),a;_(r||[])}catch(e){console.error("Failed to load users:",e),_([])}finally{l(!1)}}async function ex(r){if(r.preventDefault(),X.password&&X.password!==X.confirmPassword)return void e("Passwords do not match","error");if(X.password&&X.password.length<8)return void e("Password must be at least 8 characters","error");try{if(W){let{error:r}=await j.N.from("billing_users").update({full_name:X.full_name,role:X.role,mfa_enabled:X.mfa_enabled,updated_at:new Date().toISOString()}).eq("id",W.id);if(r)throw r;if(X.password){if(!W.auth_user_id)throw Error("User has no associated auth account");let r=await k(W.auth_user_id,X.password);if(!r.success)throw Error(r.error||"Failed to update password");e("User and password updated successfully","success")}else e("User updated successfully","success")}else{let{data:r,error:a}=await j.N.auth.signUp({email:X.email,password:X.password,options:{data:{full_name:X.full_name},emailRedirectTo:"".concat(window.location.origin,"/login")}});if(a)throw a;if(!r.user)throw Error("Failed to create auth user");let{data:{user:s}}=await j.N.auth.getUser(),{data:t,error:l}=await j.N.from("billing_users").insert({auth_user_id:r.user.id,email:X.email,full_name:X.full_name,role:X.role,is_active:!0,mfa_enabled:X.mfa_enabled,created_by:(null==s?void 0:s.id)||null}).select().single();if(l)throw l;if(X.mfa_enabled&&t){eb(),await ej(t);return}e("User created successfully!","success")}eb(),eo()}catch(r){console.error("Failed to save user:",r),e("Failed to save user: "+(r instanceof Error?r.message:"Unknown error"),"error")}}async function em(a){r("Are you sure you want to permanently delete ".concat(a.full_name,"? This action cannot be undone."),async()=>{try{if(a.auth_user_id)try{let{data:{user:e}}=await j.N.auth.getUser();console.log("Note: Auth user cannot be deleted with current permissions. Only removing from billing_users.")}catch(e){console.log("Auth deletion skipped:",e)}let{error:r}=await j.N.from("billing_users").delete().eq("id",a.id);if(r)throw r;e("User deleted successfully","success"),eo()}catch(r){console.error("Failed to delete user:",r),e("Failed to delete user: "+(r instanceof Error?r.message:"Unknown error"),"error")}})}async function eu(a){r("Approve ".concat(a.full_name," and allow them to log in?"),async()=>{try{let{error:r}=await j.N.from("billing_users").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",a.id);if(r)throw r;e("".concat(a.full_name," has been approved"),"success"),eo()}catch(r){console.error("Failed to approve user:",r),e("Failed to approve user","error")}})}async function eh(e){try{let{error:r}=await j.N.from("billing_users").update({is_active:!e.is_active}).eq("id",e.id);if(r)throw r;eo()}catch(e){console.error("Failed to toggle user status:",e)}}async function eg(a){a.mfa_enabled?r("Are you sure you want to disable MFA for ".concat(a.full_name,"?"),async()=>{try{let{error:r}=await j.N.from("billing_users").update({mfa_enabled:!1,mfa_secret:null,updated_at:new Date().toISOString()}).eq("id",a.id);if(r)throw r;e("MFA disabled successfully","success"),(null==H?void 0:H.id)===a.id&&K({...a,mfa_enabled:!1}),eo()}catch(r){console.error("Failed to disable MFA:",r),e("Failed to disable MFA","error")}}):(E(!1),await ej(a))}async function ep(r){if(r.preventDefault(),en){if(ei.newPassword!==ei.confirmNewPassword)return void e("Passwords do not match","error");if(ei.newPassword.length<8)return void e("Password must be at least 8 characters","error");try{if(!en.auth_user_id)throw Error("User has no associated auth account");let r=await k(en.auth_user_id,ei.newPassword);if(!r.success)throw Error(r.error||"Failed to update password");e("Password updated successfully for ".concat(en.full_name),"success"),el(!1),ed(null),ec({newPassword:"",confirmNewPassword:""})}catch(r){console.error("Failed to change password:",r),e(r instanceof Error?r.message:"Failed to change password","error")}}}function ey(e){J(e),Y({email:e.email,full_name:e.full_name,password:"",confirmPassword:"",role:e.role,mfa_enabled:e.mfa_enabled}),F(!0)}function eb(){F(!1),J(null)}function ef(){M(!1),es({email:"",role:"admin"}),Z("")}async function ej(r){try{let e=w.g.generateSecret(),a=await w.g.generateQRCode(r.email,e),s=w.g.generateBackupCodes();T({secret:e,qrCode:a,backupCodes:s}),L(r),q(!0)}catch(r){console.error("Failed to generate MFA setup:",r),e("Failed to generate MFA setup","error")}}async function ew(){if(R)try{let r=w.g.encryptSecret(O.secret),{error:a}=await j.N.from("billing_users").update({mfa_enabled:!0,mfa_secret:r,updated_at:new Date().toISOString()}).eq("id",R.id);if(a)throw a;e("MFA setup completed successfully! User can now use their authenticator app to log in.","success"),q(!1),L(null),eo()}catch(r){console.error("Failed to save MFA setup:",r),e("Failed to save MFA setup","error")}}function ev(){q(!1),I("qrcode"),L(null),T({secret:"",qrCode:"",backupCodes:[]}),z(""),G("")}async function ek(r){try{await navigator.clipboard.writeText(r),e("Copied to clipboard!","success")}catch(r){e("Failed to copy","error")}}async function eN(r){r.preventDefault();try{let{data:r}=await j.N.auth.getUser();if(!r.user)throw Error("Not authenticated");let a="".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15)),s=new Date;s.setDate(s.getDate()+7);let{error:t}=await j.N.from("user_invites").insert({email:ea.email,role:ea.role,invited_by:r.user.id,invite_token:a,expires_at:s.toISOString(),status:"pending"});if(t)throw t;let l="".concat(window.location.origin,"/signup?token=").concat(a);Z(l),e("Invite created successfully! Share the link below.","success")}catch(r){console.error("Failed to send invite:",r),e("Failed to send invite: "+(r instanceof Error?r.message:"Unknown error"),"error")}}async function e_(){try{await navigator.clipboard.writeText(V),e("Invite link copied to clipboard!","success")}catch(r){e("Failed to copy link","error")}}if((0,t.useEffect)(()=>{eo()},[]),a)return(0,s.jsx)("div",{className:"p-8",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-8"}),(0,s.jsx)("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded"})]})});let eC=N.filter(e=>"active"===C?e.is_active:"pending"!==C||!e.is_active),eS=N.filter(e=>!e.is_active).length;return(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-black gradient-text",children:"User Management"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Manage system users and permissions"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)(p.$,{onClick:function(){es({email:"",role:"admin"}),Z(""),M(!0)},variant:"secondary",children:[(0,s.jsx)(n,{className:"w-4 h-4 mr-2"}),"Invite User"]}),(0,s.jsxs)(p.$,{onClick:function(){J(null),Y({email:"",full_name:"",password:"",confirmPassword:"",role:"admin",mfa_enabled:!1}),er(!0),F(!0)},children:[(0,s.jsx)(d,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]}),(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(g.ZB,{children:["Users (",eC.length,")"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(p.$,{variant:"all"===C?"primary":"secondary",onClick:()=>S("all"),size:"sm",children:["All (",N.length,")"]}),(0,s.jsxs)(p.$,{variant:"active"===C?"primary":"secondary",onClick:()=>S("active"),size:"sm",children:["Active (",N.filter(e=>e.is_active).length,")"]}),(0,s.jsxs)(p.$,{variant:"pending"===C?"primary":"secondary",onClick:()=>S("pending"),size:"sm",children:["Pending (",eS,")"]})]})]})}),(0,s.jsx)(g.Wu,{children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Name"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Email"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Role"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"MFA"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Last Login"}),(0,s.jsx)("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:eC.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>{K(e),E(!0)},children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-gray-100",children:e.full_name}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:e.email}),(0,s.jsx)("td",{className:"py-3 px-4",children:"super_admin"===e.role?(0,s.jsxs)(b.E,{color:"blue",children:[(0,s.jsx)(i.A,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):(0,s.jsx)(b.E,{color:"gray",children:"Admin"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.mfa_enabled?(0,s.jsxs)(b.E,{color:"green",children:[(0,s.jsx)(c.A,{className:"w-3 h-3 mr-1"}),"Enabled"]}):(0,s.jsx)(b.E,{color:"yellow",children:"Disabled"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.is_active?(0,s.jsx)(b.E,{color:"green",children:"Active"}):(0,s.jsx)(b.E,{color:"red",children:"Inactive"})}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"Never"}),(0,s.jsx)("td",{className:"py-3 px-4",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[!e.is_active&&(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),eu(e)},className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded",title:"Approve user",children:(0,s.jsx)(o,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),ey(e)},className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:"Edit user",children:(0,s.jsx)(x.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),eh(e)},className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 rounded",title:e.is_active?"Deactivate":"Activate",children:(0,s.jsx)(i.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),em(e)},className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete user",children:(0,s.jsx)(m.A,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]}),H&&(0,s.jsx)(f.a,{isOpen:P,onClose:()=>E(!1),title:"User Details",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-gray-100",children:"User Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Name"}),(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:H.full_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Email"}),(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:H.email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Role"}),(0,s.jsx)("div",{className:"mt-1",children:"super_admin"===H.role?(0,s.jsxs)(b.E,{color:"blue",children:[(0,s.jsx)(i.A,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):(0,s.jsx)(b.E,{color:"gray",children:"Admin"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status"}),(0,s.jsx)("div",{className:"mt-1",children:H.is_active?(0,s.jsx)(b.E,{color:"green",children:"Active"}):(0,s.jsx)(b.E,{color:"red",children:"Inactive"})})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-gray-100",children:"Security"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Multi-Factor Authentication"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:H.mfa_enabled?"MFA is currently enabled for this user":"MFA is currently disabled for this user"})]}),(0,s.jsxs)(p.$,{variant:H.mfa_enabled?"secondary":"primary",onClick:()=>eg(H),children:[(0,s.jsx)(c.A,{className:"w-4 h-4 mr-2"}),H.mfa_enabled?"Disable MFA":"Enable MFA"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Password"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Change the user's password"})]}),(0,s.jsxs)(p.$,{variant:"secondary",onClick:()=>{ed(H),ec({newPassword:"",confirmNewPassword:""}),el(!0)},children:[(0,s.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Change Password"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"MFA Status"}),(0,s.jsx)("div",{className:"mt-1",children:H.mfa_enabled?(0,s.jsxs)(b.E,{color:"green",children:[(0,s.jsx)(c.A,{className:"w-3 h-3 mr-1"}),"Enabled"]}):(0,s.jsx)(b.E,{color:"yellow",children:"Disabled"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last Login"}),(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:H.last_login_at?new Date(H.last_login_at).toLocaleString():"Never"})]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-900 dark:text-gray-100",children:"Account Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Created"}),(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:new Date(H.created_at).toLocaleString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"User ID"}),(0,s.jsx)("p",{className:"font-mono text-xs text-gray-900 dark:text-gray-100",children:H.id})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)(p.$,{variant:"secondary",onClick:()=>E(!1),children:"Close"}),(0,s.jsxs)(p.$,{onClick:()=>{E(!1),ey(H)},children:[(0,s.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Edit User"]})]})]})}),(0,s.jsx)(f.a,{isOpen:A,onClose:eb,title:W?"Edit User":"Add New User",children:(0,s.jsxs)("form",{onSubmit:ex,className:"space-y-4",children:[(0,s.jsx)(y.pd,{label:"Full Name",value:X.full_name,onChange:e=>Y({...X,full_name:e.target.value}),required:!0}),(0,s.jsx)(y.pd,{label:"Email",type:"email",value:X.email,onChange:e=>Y({...X,email:e.target.value}),disabled:!!W,required:!0}),W&&(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-3 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[(0,s.jsx)("strong",{children:"Change Password:"})," Leave password fields blank to keep the current password. Enter a new password to update it."]})}),(0,s.jsx)(y.pd,{label:"Password",type:"password",value:X.password,onChange:e=>{let r=e.target.value;Y({...X,password:r}),er(r===X.confirmPassword||""===X.confirmPassword)},helpText:W?"Leave blank to keep current password (minimum 8 characters if changing)":"Minimum 8 characters",required:!W}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(y.pd,{label:"Confirm Password",type:"password",value:X.confirmPassword,onChange:e=>{let r=e.target.value;Y({...X,confirmPassword:r}),er(X.password===r||""===r)},required:!W}),X.confirmPassword&&(0,s.jsx)("div",{className:"absolute right-3 top-9 pointer-events-none",children:ee?(0,s.jsxs)("div",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 px-2 py-1 rounded",children:[(0,s.jsx)(o,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Match"})]}):(0,s.jsxs)("div",{className:"flex items-center gap-1 text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/30 px-2 py-1 rounded",children:[(0,s.jsx)(u.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Don't match"})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Role"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:"admin"===X.role,onChange:()=>Y({...X,role:"admin"}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Admin (Can manage billing data)"})]}),(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:"super_admin"===X.role,onChange:()=>Y({...X,role:"super_admin"}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Super Admin (Full access + user management)"})]})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:X.mfa_enabled,onChange:e=>Y({...X,mfa_enabled:e.target.checked}),className:"mr-2 rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Require MFA for this user"})]})}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{type:"button",variant:"secondary",onClick:eb,children:"Cancel"}),(0,s.jsx)(p.$,{type:"submit",children:W?"Update User":"Create User"})]})]})}),(0,s.jsx)(f.a,{isOpen:U,onClose:ef,title:"Invite User",children:(0,s.jsxs)("form",{onSubmit:eN,className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Generate an invitation link that can be shared with the new user to sign up."})}),(0,s.jsx)(y.pd,{label:"Email",type:"email",value:ea.email,onChange:e=>es({...ea,email:e.target.value}),required:!0}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Role"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:"admin"===ea.role,onChange:()=>es({...ea,role:"admin"}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Admin (Can manage billing data)"})]}),(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",checked:"super_admin"===ea.role,onChange:()=>es({...ea,role:"super_admin"}),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Super Admin (Full access + user management)"})]})]})]}),V&&(0,s.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-green-800 dark:text-green-300 mb-2",children:"Invitation Link Generated!"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("input",{type:"text",value:V,readOnly:!0,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-green-300 dark:border-green-700 rounded text-sm"}),(0,s.jsx)(p.$,{type:"button",variant:"secondary",onClick:e_,children:(0,s.jsx)(h.A,{className:"w-4 h-4"})})]}),(0,s.jsx)("p",{className:"text-xs text-green-700 dark:text-green-400 mt-2",children:"Share this link with the user. It expires in 7 days."})]}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{type:"button",variant:"secondary",onClick:ef,children:V?"Close":"Cancel"}),!V&&(0,s.jsxs)(p.$,{type:"submit",children:[(0,s.jsx)(n,{className:"w-4 h-4 mr-2"}),"Generate Invite Link"]})]})]})}),(0,s.jsx)(f.a,{isOpen:D,onClose:ev,title:"Set Up MFA for ".concat(null==R?void 0:R.full_name),size:"lg",children:(0,s.jsxs)("div",{className:"space-y-6",children:["qrcode"===$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-4 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[(0,s.jsx)("strong",{children:"Step 1 of 3:"})," Show this QR code to the user so they can scan it with their authenticator app (Google Authenticator, Authy, etc.)."]})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Scan QR Code"}),O.qrCode?(0,s.jsx)("div",{className:"flex justify-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,s.jsx)("img",{src:O.qrCode,alt:"MFA QR Code",className:"w-64 h-64"})}):(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"QR code is generating..."})})]}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Manual Setup Key"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"If the user can't scan the QR code, they can enter this key manually:"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("code",{className:"flex-1 text-sm font-mono text-gray-900 dark:text-gray-100",children:w.g.formatSecretForDisplay(O.secret)}),(0,s.jsx)("button",{onClick:()=>ek(O.secret),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Copy to clipboard",children:(0,s.jsx)(h.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{variant:"secondary",onClick:ev,children:"Cancel"}),(0,s.jsx)(p.$,{onClick:()=>I("verify"),children:"Next: Verify Setup"})]})]}),"verify"===$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-4 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[(0,s.jsx)("strong",{children:"Step 2 of 3:"})," Enter the 6-digit code from your authenticator app to verify the setup."]})}),(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Verify Authenticator Code"}),B&&(0,s.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 px-4 py-3 rounded-lg text-sm",children:B}),(0,s.jsx)("div",{className:"max-w-xs mx-auto",children:(0,s.jsx)(y.pd,{label:"6-Digit Code",type:"text",value:Q,onChange:e=>z(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6})}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Open your authenticator app and enter the 6-digit code shown for this account."})]}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{variant:"secondary",onClick:()=>I("qrcode"),children:"Back"}),(0,s.jsx)(p.$,{onClick:function(){return(G(""),6!==Q.length)?void G("Please enter a 6-digit code"):w.g.verifyToken(Q,O.secret)?void(z(""),I("backup")):void G("Invalid verification code. Please try again.")},disabled:6!==Q.length,children:"Verify and Continue"})]})]}),"backup"===$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-4 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[(0,s.jsx)("strong",{children:"Step 3 of 3:"})," Save these backup codes in a secure location. The user will need them if they lose access to their authenticator app."]})}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Backup Recovery Codes"}),(0,s.jsxs)("button",{onClick:()=>ek(O.backupCodes.join("\n")),className:"flex items-center gap-2 px-3 py-1 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:[(0,s.jsx)(h.A,{className:"w-4 h-4"}),"Copy All"]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Each code can only be used once. Store them in a password manager or safe location."}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:O.backupCodes.map((e,r)=>(0,s.jsx)("div",{className:"p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 font-mono text-sm text-center text-gray-900 dark:text-gray-100",children:e},r))})]}),(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 p-4 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:[(0,s.jsx)("strong",{children:"Important:"})," Make sure the user has successfully added the authenticator and saved these backup codes before completing setup."]})}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{variant:"secondary",onClick:()=>I("verify"),children:"Back"}),(0,s.jsxs)(p.$,{onClick:ew,children:[(0,s.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Complete MFA Setup"]})]})]})]})}),(0,s.jsx)(f.a,{isOpen:et,onClose:()=>{el(!1),ed(null),ec({newPassword:"",confirmNewPassword:""})},title:"Change Password for ".concat(null==en?void 0:en.full_name),children:(0,s.jsxs)("form",{onSubmit:ep,className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Enter a new password for this user. The password must be at least 8 characters long."})}),(0,s.jsx)(y.pd,{label:"New Password",type:"password",value:ei.newPassword,onChange:e=>ec({...ei,newPassword:e.target.value}),placeholder:"••••••••",required:!0,autoComplete:"new-password",helpText:"Minimum 8 characters"}),(0,s.jsx)(y.pd,{label:"Confirm New Password",type:"password",value:ei.confirmNewPassword,onChange:e=>ec({...ei,confirmNewPassword:e.target.value}),placeholder:"••••••••",required:!0,autoComplete:"new-password"}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(p.$,{type:"button",variant:"secondary",onClick:()=>{el(!1),ed(null),ec({newPassword:"",confirmNewPassword:""})},className:"flex-1",children:"Cancel"}),(0,s.jsx)(p.$,{type:"submit",className:"flex-1",children:"Update Password"})]})]})})]})}}},e=>{e.O(0,[268,143,772,906,441,255,358],()=>e(e.s=28666)),_N_E=e.O()}]);