(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{3941:(e,r,t)=>{"use strict";t.d(r,{N:()=>a});let a=(0,t(70945).UU)("https://cpkslvmydfdevdftieck.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNwa3Nsdm15ZGZkZXZkZnRpZWNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5MDAyOTUsImV4cCI6MjA2MjQ3NjI5NX0.IfkIVsp3AtLOyXDW9hq9bEvnozd9IaaUay244iDhWGE")},5370:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(71847).A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]])},8829:(e,r,t)=>{"use strict";t.d(r,{TM:()=>l,l6:()=>n,pd:()=>s});var a=t(95155);function s(e){let{label:r,error:t,helperText:s,helpText:l,className:n="",...i}=e,o=s||l;return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:r}),(0,a.jsx)("input",{className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 ".concat(t?"border-red-500":"border-gray-300 dark:border-gray-600"," ").concat(n),...i}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:t}),o&&!t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:o})]})}function l(e){let{label:r,error:t,helperText:s,className:l="",...n}=e;return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:r}),(0,a.jsx)("textarea",{className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 ".concat(t?"border-red-500":"border-gray-300 dark:border-gray-600"," ").concat(l),...n}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:t}),s&&!t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:s})]})}function n(e){let{label:r,error:t,helperText:s,options:l,className:n="",...i}=e;return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:r}),(0,a.jsx)("select",{className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 ".concat(t?"border-red-500":"border-gray-300 dark:border-gray-600"," ").concat(n),...i,children:l.map(e=>(0,a.jsx)("option",{value:e.value,className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:e.label},e.value))}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:t}),s&&!t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:s})]})}t(12115)},28297:(e,r,t)=>{"use strict";t.d(r,{Wu:()=>i,ZB:()=>n,Zp:()=>s,aR:()=>l});var a=t(95155);function s(e){let{children:r,className:t=""}=e;return(0,a.jsx)("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm border border-gray-300 dark:border-gray-700 ".concat(t),children:r})}function l(e){let{children:r,className:t=""}=e;return(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 ".concat(t),children:r})}function n(e){let{children:r,className:t=""}=e;return(0,a.jsx)("h3",{className:"text-lg font-bold gradient-text ".concat(t),children:r})}function i(e){let{children:r,className:t=""}=e;return(0,a.jsx)("div",{className:"px-6 py-4 ".concat(t),children:r})}t(12115)},45404:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>x});var a=t(95155),s=t(12115),l=t(20063),n=t(15239),i=t(17910),o=t(5370),d=t(28297),c=t(70667),u=t(8829),m=t(3941),g=t(53233);function x(){let e=(0,l.useRouter)(),[r,t]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[b,h]=(0,s.useState)(!1),[p,y]=(0,s.useState)({email:"",password:""}),[w,N]=(0,s.useState)({email:"",password:"",confirmPassword:"",fullName:""}),[k,v]=(0,s.useState)(""),[j,_]=(0,s.useState)("");async function S(r){r.preventDefault(),_(""),t(!0);try{let{data:r,error:a}=await m.N.auth.signInWithPassword({email:p.email,password:p.password});if(a)throw a;if(!r.user)throw Error("Login failed");let{data:s,error:l}=await m.N.from("billing_users").select("*").eq("auth_user_id",r.user.id).single();if(l||!s)throw await m.N.auth.signOut(),Error("User not authorized for billing system");if(!s.is_active)throw await m.N.auth.signOut(),Error("Your account is pending approval from an administrator. Please wait for activation.");if(s.mfa_enabled){f(!0),t(!1);return}await m.N.from("billing_users").update({last_login_at:new Date().toISOString()}).eq("id",s.id),await m.N.from("login_history").insert({billing_user_id:s.id,email:p.email,login_successful:!0,mfa_verified:!1}),sessionStorage.setItem("mfa_verified","true"),sessionStorage.setItem("mfa_verified_at",new Date().toISOString()),e.push("/admin/billing")}catch(e){console.error("Login error:",e),_(e instanceof Error?e.message:"Login failed"),t(!1)}}async function C(r){r.preventDefault(),_(""),t(!0);try{if(!/^\d{6}$/.test(k))throw Error("Invalid MFA code format. Please enter 6 digits.");let{data:{user:r}}=await m.N.auth.getUser();if(!r)throw Error("Not authenticated");let{data:t}=await m.N.from("billing_users").select("*").eq("auth_user_id",r.id).single();if(!t)throw Error("User not found");if(t.mfa_secret){let e=g.g.decryptSecret(t.mfa_secret);if(!g.g.verifyToken(k,e))throw Error("Invalid MFA code. Please try again.")}else throw Error("MFA not properly configured for this user");await m.N.from("billing_users").update({last_login_at:new Date().toISOString()}).eq("id",t.id),await m.N.from("login_history").insert({billing_user_id:t.id,email:p.email,login_successful:!0,mfa_verified:!0}),sessionStorage.setItem("mfa_verified","true"),sessionStorage.setItem("mfa_verified_at",new Date().toISOString()),e.push("/admin/billing")}catch(e){console.error("MFA verification error:",e),_(e instanceof Error?e.message:"MFA verification failed"),t(!1)}}async function I(e){e.preventDefault(),_(""),t(!0);try{if(w.password!==w.confirmPassword)throw Error("Passwords do not match");if(w.password.length<8)throw Error("Password must be at least 8 characters");if(!w.fullName.trim())throw Error("Full name is required");let{data:e,error:r}=await m.N.auth.signUp({email:w.email,password:w.password,options:{data:{full_name:w.fullName}}});if(r)throw r;if(!e.user)throw Error("Registration failed");let{error:t}=await m.N.from("billing_users").insert({auth_user_id:e.user.id,email:w.email,full_name:w.fullName,role:"admin",is_active:!1,mfa_enabled:!1});if(t)throw await m.N.auth.admin.deleteUser(e.user.id),t;await m.N.auth.signOut(),_(""),h(!1),N({email:"",password:"",confirmPassword:"",fullName:""}),alert("Registration successful! Your account is pending approval from an administrator. You will be able to log in once your account is activated.")}catch(e){console.error("Registration error:",e),_(e instanceof Error?e.message:"Registration failed"),t(!1)}}return(0,a.jsx)("div",{className:"min-h-screen bg-gray-200 dark:bg-gray-900 flex items-start justify-center p-4 pt-8 md:pt-16",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-6 md:mb-8",children:[(0,a.jsx)("div",{className:"flex justify-center mb-3 md:mb-4",children:(0,a.jsx)(n.default,{src:"https://nexasync.ca/images/NexaSync-White.png",alt:"NexaSync Logo",width:220,height:60,className:"h-12 md:h-16 w-auto",priority:!0})}),(0,a.jsx)("h1",{className:"text-xl md:text-2xl gradient-text mb-2",children:"Billing Admin"}),(0,a.jsxs)("p",{className:"text-sm md:text-base text-gray-600 dark:text-gray-400 flex items-center justify-center gap-2",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"MFA Protected • Super User Access"}),(0,a.jsx)("span",{className:"sm:hidden",children:"MFA Protected"})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-center",children:x?"Enter MFA Code":b?"Create New Account":"Sign In"})}),(0,a.jsx)(d.Wu,{children:x?(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[j&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 px-4 py-3 rounded-lg text-sm",children:j}),(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 mb-2",children:[(0,a.jsx)(o.A,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),(0,a.jsx)("p",{className:"text-sm md:text-base font-semibold text-blue-900 dark:text-blue-300 text-center",children:"Multi-Factor Authentication Required"})]}),(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-400 text-center",children:"Enter the 6-digit code from your authenticator app."})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1 text-center",children:"MFA Code"}),(0,a.jsx)("input",{type:"text",value:k,onChange:e=>v(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",required:!0,autoComplete:"one-time-code",maxLength:6,pattern:"\\d{6}",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600 text-center text-2xl tracking-widest font-mono"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(c.$,{type:"button",variant:"secondary",onClick:async()=>{await m.N.auth.signOut(),f(!1),v(""),_("")},className:"flex-1",children:"Back"}),(0,a.jsx)(c.$,{type:"submit",className:"flex-1",loading:r,children:"Verify"})]})]}):b?(0,a.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[j&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 px-4 py-3 rounded-lg text-sm",children:j}),(0,a.jsx)(u.pd,{label:"Full Name",type:"text",value:w.fullName,onChange:e=>N({...w,fullName:e.target.value}),placeholder:"John Doe",required:!0,autoComplete:"name"}),(0,a.jsx)(u.pd,{label:"Email",type:"email",value:w.email,onChange:e=>N({...w,email:e.target.value}),placeholder:"admin@example.com",required:!0,autoComplete:"email"}),(0,a.jsx)(u.pd,{label:"Password",type:"password",value:w.password,onChange:e=>N({...w,password:e.target.value}),placeholder:"••••••••",required:!0,autoComplete:"new-password",helpText:"Minimum 8 characters"}),(0,a.jsx)(u.pd,{label:"Confirm Password",type:"password",value:w.confirmPassword,onChange:e=>N({...w,confirmPassword:e.target.value}),placeholder:"••••••••",required:!0,autoComplete:"new-password"}),(0,a.jsx)(c.$,{type:"submit",className:"w-full",loading:r,children:"Create Account"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>{h(!1),_("")},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Already have an account? Sign in"})})]}):(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[j&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 px-4 py-3 rounded-lg text-sm",children:j}),(0,a.jsx)(u.pd,{label:"Email",type:"email",value:p.email,onChange:e=>y({...p,email:e.target.value}),placeholder:"admin@example.com",required:!0,autoComplete:"email"}),(0,a.jsx)(u.pd,{label:"Password",type:"password",value:p.password,onChange:e=>y({...p,password:e.target.value}),placeholder:"••••••••",required:!0,autoComplete:"current-password"}),(0,a.jsx)(c.$,{type:"submit",className:"w-full",loading:r,children:"Sign In"}),(0,a.jsx)("div",{className:"text-center pt-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>{h(!0),_("")},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Don't have an account? Create one"})})]})})]}),(0,a.jsx)("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400 mt-6",children:"Protected by Supabase Authentication & MFA"})]})})}},53233:(e,r,t)=>{"use strict";t.d(r,{g:()=>i});var a=t(12503),s=t(52769),l=t(15376).Buffer;class n{generateSecret(){return a.authenticator.generateSecret()}async generateQRCode(e,r){let t=a.authenticator.keyuri(e,"NexaSync Billing",r);try{return await s.toDataURL(t)}catch(e){throw console.error("Failed to generate QR code:",e),Error("Failed to generate QR code")}}generateBackupCodes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,r=[];for(let t=0;t<e;t++){let e=Math.random().toString(36).substring(2,10).toUpperCase();r.push(e)}return r}verifyToken(e,r){try{let t=e.replace(/[\s-]/g,"");return a.authenticator.verify({token:t,secret:r})}catch(e){return console.error("Token verification failed:",e),!1}}generateToken(e){return a.authenticator.generate(e)}encryptSecret(e){return l.from(e).toString("base64")}decryptSecret(e){return l.from(e,"base64").toString("utf-8")}formatSecretForDisplay(e){var r;return(null==(r=e.match(/.{1,4}/g))?void 0:r.join(" "))||e}}let i=new n},55633:(e,r,t)=>{Promise.resolve().then(t.bind(t,45404))},70667:(e,r,t)=>{"use strict";t.d(r,{$:()=>s});var a=t(95155);function s(e){let{variant:r="primary",size:t="md",loading:s=!1,disabled:l,children:n,className:i="",...o}=e;return(0,a.jsxs)("button",{className:"".concat("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 dark:bg-blue-500 text-white hover:bg-blue-700 dark:hover:bg-blue-600 focus:ring-blue-500 disabled:bg-blue-300 dark:disabled:bg-blue-800",secondary:"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600 focus:ring-gray-500 disabled:bg-gray-100 dark:disabled:bg-gray-800",danger:"bg-red-600 dark:bg-red-500 text-white hover:bg-red-700 dark:hover:bg-red-600 focus:ring-red-500 disabled:bg-red-300 dark:disabled:bg-red-800",ghost:"bg-transparent text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:ring-gray-500"}[r]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[t]," ").concat(i," ").concat(l||s?"cursor-not-allowed opacity-50":""),disabled:l||s,...o,children:[s&&(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n]})}t(12115)},83011:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return s}});let a=t(12115);function s(e,r){let t=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=t.current;e&&(t.current=null,e());let r=s.current;r&&(s.current=null,r())}else e&&(t.current=l(e,a)),r&&(s.current=l(r,a))},[e,r])}function l(e,r){if("function"!=typeof e)return e.current=r,()=>{e.current=null};{let t=e(r);return"function"==typeof t?t:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)}},e=>{e.O(0,[268,143,772,394,441,255,358],()=>e(e.s=55633)),_N_E=e.O()}]);