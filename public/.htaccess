# Disable directory listing but allow index files
Options -Indexes +FollowSymLinks

# Enable Rewrite Engine
RewriteEngine On
RewriteBase /

# Force HTTPS (optional but recommended)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# Remove trailing slashes (important for preventing 403)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# Handle root index
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^$ /index.html [L]

# Rewrite /admin/billing/profile/mfa-setup to /admin/billing/profile/mfa-setup.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^admin/billing/profile/mfa-setup$ /admin/billing/profile/mfa-setup.html [L]

# Rewrite /admin/billing/invoices/generate to /admin/billing/invoices/generate.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^admin/billing/invoices/generate$ /admin/billing/invoices/generate.html [L]

# Rewrite /admin/billing/* routes to corresponding HTML files
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^admin/billing/([^/]+)$ /admin/billing/$1.html [L]

# Rewrite /admin/billing to /admin/billing.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^admin/billing$ /admin/billing.html [L]

# Rewrite /login to /login.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^login$ /login.html [L]

# Rewrite /signup to /signup.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^signup$ /signup.html [L]

# General rule: Try to serve .html version if file doesn't exist
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ /$1.html [L]

# Fallback to index.html for any unmatched routes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.html [L]

# Set proper MIME types
AddType application/javascript .js
AddType text/css .css
AddType image/svg+xml .svg

# Enable compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 year"
</IfModule>
